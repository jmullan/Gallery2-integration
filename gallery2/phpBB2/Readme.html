<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
	<head>
		<meta content="text/html; charset=us-ascii" http-equiv="Content-Type" />
		<title>
		README: Gallery 2 phpBB2 Integration Package
		</title>
		<style type="text/css">
		html {
		font-family: "Lucida Grande", Verdana, Arial, sans-serif;
		font-size: 62.5%;
		}
		body {
		font-size: 1.2em;
		margin: 16px 16px 0px 16px;
		background: white;
		}
		a {
		text-decoration: none;
		}
		p {
		line-height: 1.5em;
		}
		h2 {
		font-family: "Gill Sans", Verdana, Arial, sans-serif;
		font-size: 1.5em;
		color: #333;
		border-bottom: 1px solid #ddd;
		margin: 0;
		padding: 1.0em 0 0.15em 0;
		}
		ul, ol {
		margin: 1.2em 0 1.2em 1.75em;
		padding: 0;
		}
		li {
		padding: 0.2em 0;
		line-height: 1.5em;
		}
		ol ul {
		margin-top: 0.4em;
		margin-bottom: 0.4em;
		}
		a:link {
		font-weight: 700;
		color: #5D728E;
		background-color: transparent;
		}
		a:visited {
		font-weight: 700;
		color: #5D728E;
		background-color: transparent;
		}
		a:hover {
		font-weight: 700;
		color: #B30400;
		text-decoration: underline;
		}
		div.instructions {
		background: #ddd;
		border: 1px solid #777;
		width: 480px;
		margin: 8px;
		padding: 0px;
		}
		div.instructions h3 {
		background: #ccc;
		border-bottom: 1px solid #777;
		font-size: 1.1em;
		margin: 0px 0px 4px 0px;
		padding: 4px;
		}
		div.instructions p {
		margin: 0px 0px 0px 4px;
		}
		.fineprint {
		font-size: .8em;
		color: #ccc;
		}
		div.toc {
		float: right;
		border: 1px solid #F15D22;
		background: #e9eff3;
		padding: 2px 4px 2px 4px;
		margin: 15px auto auto 15px;
		}
		div.toc h2 {
		font-size: 1.1em;
		margin-top: -8px;
		}
		p.toc-link {
		margin: 0px;
		}
		ul.toc-level-1 {
		margin: 0px 16px 0px 16px;
		list-style-type: none;
		}
		ul.toc-level-1 li {
		margin: auto;
		font-weight: bold;
		}
		ul.toc-level-2 {
		margin: auto 0px auto 15px;
		list-style-type: none;
		}
		ul.toc-level-2 li {
		margin: auto;
		}
		ul.toc-level-3 {
		margin: auto 0px auto 20px;
		list-style-type: none;
		}
		ul.toc-level-3 li {
		margin: auto;
		}
		pre.CodeSnippet	{
		background-color: #f0f0f0;
		padding: 1em;
		margin: 0px;
		border: 1px solid gray;
		font-family: "Lucida Console";
		font-size: 1em ;
		width: 800px ;
		color: #000000;
		overflow:auto;
		}
		pre.Console	{
		width: auto ;
		background-color: #000000; 
		color: #00ff00;
		}
		div.codecontainer {
		margin: 0px;
		width:800px;
		padding: 1em;
		}
		div.codecontainer h3 {
		background: #ccc;
		font-size: 1.1em;
		margin: 0px 0px 0px 0px;
		padding: 4px;
		}
		.important {
		background: #FACA61;
		border: 2px;
		width: 480px;
		margin: 0.6em 0 0.6em 0;
		padding: 0.6em;
		color: #C00;
		text-align: center;
		}
		.important .email {
		font-size: 1.3em;
		color: black;
		font-weight: 700;
		margin: 0.6em 0 0 0;
		}
		.important h3 {
		color: #eee;
		background: #f00;
		font-size: 1.3em;
		margin: -0.2em -0.2em 0.2em -0.2em;
		padding: 0.2em 0.2em;
		}
	</style>
	</head>
	<body>
		<div class="toc">
		<h2>
		<a name="toc">Contents</a>
		</h2>
		<ul class="toc-level-1">
			<li>
			Introduction
				<ul class="toc-level-2">
					<li>
					<a href="#description">
					Description
					</a>
					</li>
					<li>
					<a href="#dodont">
					What this package does
					</a>
					</li>
				</ul>
			</li>
			<li>
			Installation
				<ul class="toc-level-2">
					<li>
					<a href="#installing">
					Installing
					</a>
					<ul class="toc-level-3">
						<li>
						<a href="#mod">
						Optional MOD
						</a>
						</li>
					</ul>
					</li>
					<li>
					<a href="#configuration">
					Configuration
					</a>
					</li>
				</ul>
			</li>
			<li>
			Help!
				<ul class="toc-level-2">
					<li>
					<a href="#getting_help">
					Getting Help
					</a>
					</li>
					<li>
					<a href="#known_issues">
					Known Issues / Bugs
					</a>
					</li>
				</ul>
			</li>
		</ul>
		</div>
		<div>
		<img alt="Gallery 2" src="images/g2Logo.gif" />
		</div>
		<p>
		Welcome to Gallery 2.1. This integration package is part of the 
		ongoing effort to seamlessly integrate Gallery 2.1 in phpBB2.  
		Please read through this document carefully
		before integrating Gallery 2.1 and before asking for help.  We have
		taken care to try to answer as many of your questions here as
		possible.  If you don't read this and have problems, we may
		refer you back to this document as a first resource.
		</p>
		<h2>
		<a name="description">
		Description
		</a>
		</h2>
		<p>
		This package contains all the files and directories you will need 
		in order to integrate Gallery 2.1 into your phpBB2 website.  
		<b>Standard Disclaimer: Back up all files/folders/databases 
		related to Gallery 2 before attempting this integration.</b>
		</p>
		<h2>
		<a name="dodont">
		What this package does
		</a>
		</h2>
		<p class="toc-link">
		<a href="#toc">
		[table of contents]
		</a>
		</p>
		<p>
		Simply put, this package allows you to integrate Gallery 2.1 into phpBB2.  Among 
		it's many features, it:
		</p>
		<ol>
			<li>Creates an administration link/page in the phpBB2 administration page.</li>
			<li>Allows you to export your existing phpBB2 users and groups to Gallery 2.</li>
		</ol>
		<p>
		This integration package <b>does not</b> install or configure Gallery 2.1 for you.  Before you 
		proceed with this integration, you <b>must</b> install and configure Gallery 2.1.
		</p>
		<h2>
		<a name="installing">
		Installation
		</a>
		</h2>
		<p class="toc-link">
		<a href="#toc">
		[table of contents]
		</a>
		</p>
		<div class="important">
		<h3>NOTICE</h3>
		<p>
		This integration package <b>does not</b> install or configure Gallery 2.1 for you.  Before you 
		proceed with this integration, you <b>must</b> install and configure Gallery 2.1.
		</p></div>
		<br />
		<div class="important">
		<h3>IMPORTANT</h3>
		<p>
		The use of the Gallery 2.1 rewrite module in an integrated environment has proven to be a tricky task.  It is highly 
		recommended that you deactivate the Gallery 2 rewrite module prior to attempting this integration.
		</p></div>
		<p>
		This package contains four folders:
		</p>
		<ul>
		<li>gallery2/</li>
		<li>admin/</li>
		<li>templates/</li>
		<li>images/</li>
		</ul>
		<p>
		To install, simply upload the contents of the admin and templates folders into the 
		corresponding folders in your phpBB2 installation.</p>
		<pre class="CodeSnippet">
	phpBB2/gallery2.php
	phpBB2/g2helper.inc
	phpBB2/admin/admin_gallery2.php
	phpBB2/admin/gallery2_export.php
	phpBB2/admin/g2helper_admin.inc
	phpBB2/admin/G2EmbedDiscoveryUtilities.class
	phpBB2/templates/subSilver/gallery2.tpl
	phpBB2/templates/subSilver/admin/gallery2_config_body.tpl
	phpBB2/templates/subSilver/admin/gallery2_export.tpl
	phpBB2/templates/subSilver/admin/gallery2_show_body.tpl
	phpBB2/templates/subSilver/admin/gallery2_sync_intro_body.tpl
	phpBB2/templates/subSilver/images/exif_parser.gif
	gallery2/modules/core/templates/blocks/local/BreadCrumb.tpl</pre>
		<p>
		The gallery2 folder contains a customized breadcrumb navigation file that will include 
		a link back to your forum's index page. To use this feature, create a directory called 
		"local" within gallery2/modules/core/templates/blocks and copy this version of BreadCrumb.tpl 
		into your new "local" directory:
		</p>
		<div class="codecontainer"><h3>Unix Example</h3>
		<pre class="CodeSnippet Console">$ mkdir ~/public_html/gallery2/modules/core/templates/blocks/local
$ cp BreadCrumb.tpl ~/public_html/gallery2/modules/core/templates/blocks/local/</pre></div>
		<div class="codecontainer"><h3>Windows Example</h3>
		<pre class="CodeSnippet Console">C:\> mkdir c:\web\gallery2\modules\core\templates\blocks\local
C:\> copy BreadCrumb.tpl c:\web\gallery2\modules\core\templates\blocks\local\</pre></div>
		<p>Note that you may want to alter the following line in the included BreadCrumb.tpl file to 
		reflect the actual home page of your forums:</p>
		<div class="instructions">
		<p><span class="code">&lt;a href="/" class="BreadCrumb-1"&gt;Forum Index&lt;/a&gt;</span></p></div>
		<p>There is a known issue with the font size in the phpBB2 integration. To fix this, make the following 
		changes:</p>
		<pre class="CodeSnippet">
#
#-----[ OPEN ]------------------------------------------
# 
templates/subSilver/subSilver.css
# OR
templates/subSilver/overall_header.tpl

#
#-----[ FIND ]------------------------------------------
#
 scrollbar-darkshadow-color: #98AAB1;
} 

#
#-----[ AFTER, ADD ]------------------------------------------
#
#gsNavBar div.gbBreadCrumb {
font-size: 1.6em;
}

span.block-core-SystemLink {
font-size: 1.6em;
} 

#
#-----[ FIND ]------------------------------------------
#
font,th,td,p { font-family: Verdana, Arial, Helvetica, sans-serif }

#
#-----[ IN-LINE FIND ]------------------------------------------------
#
font-family:

#
#-----[ IN-LINE BEFORE, ADD ]-----------------------------
#
font-size: 10px;

#
#-----[ SAVE/CLOSE ALL FILES ]------------------------------------------
#
# EoM</pre>
		<p>The following MOD contains the required SQL and file modifications:</p>
		<pre class="CodeSnippet">#
#-----[ SQL ]------------------------------------------
# (Use correct table prefix if not phpbb)
# 
CREATE TABLE `phpbb_gallery2` (
`fullPath` VARCHAR( 255 ) NOT NULL ,
`embedUri` VARCHAR( 255 ) NOT NULL ,
`g2Uri` VARCHAR( 255 ) NOT NULL ,
`loginRedirect` VARCHAR( 255 ) NOT NULL ,
`activeAdminId` INT NOT NULL
);

#
#-----[ OPEN ]------------------------------------------
# 
groupcp.php

#
#-----[ FIND ]------------------------------------------
# 
					$sql = "INSERT INTO " . USER_GROUP_TABLE . " (user_id, group_id, user_pending) 
						VALUES (" . $row['user_id'] . ", $group_id, 0)";

#
#-----[ BEFORE, ADD ]------------------------------------------
# 
					// Add new user to group in gallery
					require($phpbb_root_path . 'g2helper.inc');
					$g2h = new g2helper($db);
					$g2h->addUserToGroup($row['user_id'], $group_id);

#
#-----[ FIND ]------------------------------------------
# 
						$sql = "UPDATE " . USER_GROUP_TABLE . " 
							SET user_pending = 0 
							WHERE user_id IN ($sql_in) 
								AND group_id = $group_id";
						$sql_select = "SELECT user_email 
							FROM ". USERS_TABLE . " 
							WHERE user_id IN ($sql_in)"; 

#
#-----[ BEFORE, ADD ]------------------------------------------
# 
						// Add new user to group in gallery
						require($phpbb_root_path . 'g2helper.inc');
						$g2h = new g2helper($db);
						$g2h->addUserToGroup($sql_in, $group_id);

#
#-----[ FIND ]------------------------------------------
# 
						$sql = "DELETE FROM " . USER_GROUP_TABLE . " 
							WHERE user_id IN ($sql_in) 
								AND group_id = $group_id";

#
#-----[ BEFORE, ADD ]------------------------------------------
# 
						// Remove user from group in gallery
						require($phpbb_root_path . 'g2helper.inc');
						$g2h = new g2helper($db);
						$g2h->removeUserFromGroup($sql_in, $group_id);

#
#-----[ OPEN ]------------------------------------------
# 
login.php

#
#-----[ FIND ]------------------------------------------
# 
	else if( ( isset($HTTP_GET_VARS['logout']) || isset($HTTP_POST_VARS['logout']) ) && $userdata['session_logged_in'] )
	{

#
#-----[ AFTER, ADD ]------------------------------------------
#
		// Logout of gallery
 		$g2_sql = 'SELECT fullPath, embedUri FROM ' . GALLERY2_TABLE;
		$g2_row = $db->sql_fetchrow($db->sql_query($g2_sql));
		$fullPath = $g2_row['fullPath'];
		$embedUri = $g2_row['embedUri'];
		require_once($fullPath); 
		$g2_ret = GalleryEmbed::logout(array('embedUri' => $embedUri));

#
#-----[ OPEN ]------------------------------------------
# 
admin/admin_groups.php

#
#-----[ FIND ]------------------------------------------
# 
		//
		// Delete Group
		//

#
#-----[ AFTER, ADD ]------------------------------------------
# 
		// Delete group in gallery
		require($phpbb_root_path . 'g2helper.inc');
		$g2h = new g2helper($db);
		$g2h->deleteGroup($group_id);

#
#-----[ FIND ]------------------------------------------
# 
			$sql = "UPDATE " . GROUPS_TABLE . "
				SET group_type = $group_type, group_name = '" . str_replace("\'", "''", $group_name) . "', group_description = '" . str_replace("\'", "''", $group_description) . "', group_moderator = $group_moderator 
				WHERE group_id = $group_id";

#
#-----[ BEFORE, ADD ]------------------------------------------
# 
			// Update group in gallery
			require($phpbb_root_path . 'g2helper.inc');
			$g2h = new g2helper($db);
			$g2h->updateGroup($group_id, str_replace("\'", "''", $group_name));

#
#-----[ FIND ]------------------------------------------
# 
		else if( $mode == 'newgroup' )
		{

#
#-----[ AFTER, ADD ]------------------------------------------
# 
			// Create new group in gallery
			require($phpbb_root_path . 'g2helper.inc');
			$g2h = new g2helper($db);
			$g2h->createGroup(str_replace("\'", "''", $group_name));

#
#-----[ OPEN ]------------------------------------------
# 
admin/admin_ug_auth.php

#
#-----[ FIND ]------------------------------------------
# 
		//
		// Make user an admin (if already user)
		//
		if ( $userdata['user_id'] != $user_id )
		{

#
#-----[ AFTER, ADD ]------------------------------------------
# 
			// Add admin to gallery
			require($phpbb_root_path . 'g2helper.inc');
			$g2h = new g2helper($db);
			$g2h->mapUserToAdmin($user_id);

#
#-----[ FIND ]------------------------------------------
# 
				//
				// Update users level, reset to USER
				//

#
#-----[ AFTER, ADD ]------------------------------------------
# 
			   	// Remove admin from gallery
				require($phpbb_root_path . 'g2helper.inc');
				$g2h = new g2helper($db);
				$g2h->mapAdminToUser($user_id);

#
#-----[ OPEN ]------------------------------------------
# 
admin/admin_users.php

#
#-----[ FIND ]------------------------------------------
# 
		if (!($this_userdata = get_userdata($user_id)))
		{
			message_die(GENERAL_MESSAGE, $lang['No_user_id_specified'] );
		}

		if( $HTTP_POST_VARS['deleteuser'] && ( $userdata['user_id'] != $user_id ) )
		{

#
#-----[ AFTER, ADD ]------------------------------------------
# 
			// Remove user from Gallery
			require($phpbb_root_path . 'g2helper.inc');
			$g2h = new g2helper($db);
			$g2h->deleteUser($user_id);

#
#-----[ FIND ]------------------------------------------
# 
			if($password != $password_confirm)
			{
				$error = TRUE;
				$error_msg .= ( ( isset($error_msg) ) ? '&lt;br /&gt;' : '' ) . $lang['Password_mismatch'];
			}
			else
			{
				$password = md5($password);
				$passwd_sql = "user_password = '$password', ";


#
#-----[ AFTER, ADD ]------------------------------------------
# 
				// Change password in gallery
				require($phpbb_root_path . 'g2helper.inc');
				$g2h = new g2helper($db);
				$g2h->changePassword($user_id, $password);

#
#-----[ OPEN ]------------------------------------------
# 
includes/constants.php

#
#-----[ FIND ]------------------------------------------
# 
define('VOTE_USERS_TABLE', $table_prefix.'vote_voters');

#
#-----[ AFTER, ADD ]------------------------------------------
# 
define('GALLERY2_TABLE', $table_prefix.'gallery2');

#
#-----[ OPEN ]------------------------------------------
# 
includes/page_header.php

#
#-----[ FIND ]------------------------------------------
# 
	'L_WHOSONLINE_MOD' => sprintf($lang['Mod_online_color'], '&lt;span style="color:#' . $theme['fontcolor2'] . '"&gt;', '&lt;/span&gt;'),

#
#-----[ AFTER, ADD ]------------------------------------------
# 
	'L_GALLERY2' => 'Gallery 2',

#
#-----[ FIND ]------------------------------------------
# 
	'U_GROUP_CP' => append_sid('groupcp.'.$phpEx),

#
#-----[ AFTER, ADD ]------------------------------------------
# 
	'U_GALLERY2' => append_sid('gallery2.'.$phpEx),

#
#-----[ OPEN ]------------------------------------------
# 
includes/usercp_register.php

#
#-----[ FIND ]------------------------------------------
# 
		}

			if ( !$error )
			{
				$new_password = md5($new_password);
				$passwd_sql = "user_password = '$new_password', ";

#
#-----[ AFTER, ADD ]------------------------------------------
# 
				// Change password in gallery
				if ($mode != 'register') {
					require($phpbb_root_path . 'g2helper.inc');
					$g2h = new g2helper($db);
					$g2h->changePassword($user_id, $new_password);
				}

#
#-----[ OPEN ]------------------------------------------
# 
templates/subSilver/overall_header.tpl

#
#-----[ FIND ]------------------------------------------
#
&lt;link rel="stylesheet" href="templates/subSilver/{T_HEAD_STYLESHEET}" type="text/css"&gt;

#
#-----[ BEFORE, ADD ]------------------------------------------
#
{GALLERY2_JAVASCRIPT}
{GALLERY2_CSS}

#
#-----[ FIND ]------------------------------------------
# 
&lt;img src="templates/subSilver/images/icon_mini_login.gif" width="12" height="13" border="0" alt="{L_LOGIN_LOGOUT}" hspace="3" /&gt;{L_LOGIN_LOGOUT}&lt;/a&gt;&amp;nbsp;

#
#-----[ IN-LINE AFTER, ADD ]------------------------------------------
# 
&amp;nbsp;&lt;a href="{U_GALLERY2}" class="mainmenu"&gt;&lt;img src="templates/subSilver/images/exif_parser.gif" border="0" alt="{L_GALLERY2}" hspace="3" /&gt;{L_GALLERY2}&lt;/a&gt;&amp;nbsp;

#
#-----[ SAVE/CLOSE ALL FILES ]------------------------------------------
#
# EoM
		</pre>
		<h2>
		<a name="mod">
		Optional Profile MODification
		</a>
		</h2>
		<p class="toc-link">
		<a href="#toc">
		[table of contents]
		</a>
		</p>
		<p>
		This MOD will create a "Gallery" button in the user's profile, as well as in the user's posts, where the AIM/ICQ buttons appear.  See 
		<a href="http://www.nukedgallery.net/postp13384.html#13384">http://www.nukedgallery.net/postp13384.html#13384</a> for screenshots.
		</p>
		<pre class="CodeSnippet">
##############################################################
## MOD Title: Gallery Profile Mod 
## MOD Author: PilotSpike &lt; firefighterspike33@yahoo.com &gt; (N/A) NA 
## MOD Description: This mod integrates the nuked G2 integration into user profiles 
## MOD Version: 0.1.0 
##
## Installation Level: Intermediate
## Installation Time: 45 Minutes
## Files To Edit: admin/admin_users.php, 
##	includes/usercp_register.php,
##	includes/usercp_viewprofile.php,
##	includes/functions_validate.php,
##	language/lang_english/lang_admin.php,
##	language/lang_english/lang_main.php,
##	templates/subSilver/admin/user_edit_body.tpl,
##	templates/subSilver/viewtopic_body.tpl,
##	templates/subSilver/profile_view_body.tpl,
##	templates/subSilver/privmsgs_read_body.tpl,
##	templates/subSilver/subSilver.cfg,
##	viewtopic.php,
##	privmsg.php
## Included Files: images/icon_gallery.gif 
## License: http://opensource.org/licenses/gpl-license.php GNU General Public License v2
##############################################################
## For security purposes, please check: http://www.phpbb.com/mods/
## for the latest version of this MOD. Although MODs are checked
## before being allowed in the MODs Database there is no guarantee
## that there are no security problems within the MOD. No support
## will be given for MODs not found within the MODs Database which
## can be found at http://www.phpbb.com/mods/
##############################################################
## Author Notes:
##
##############################################################
## MOD History:
##
## 2005-12-17 - Version 0.1.0 
##      - Initial Developmental Release 
##
## 2006-01-16 - A few tweaks to make code functional - Scott Gregory (aka...jettyrat)
##	includes/usercp_register.php,
##	includes/usercp_viewprofile.php,
##	language/lang_english/lang_main.php,
##
##############################################################
## Before Adding This MOD To Your Forum, You Should Back Up All Files Related To This MOD
##############################################################


#
#-----[ SQL ]------------------------------------------
#
ALTER TABLE phpbb_users ADD user_gallery VARCHAR(10) NULL DEFAULT NULL; 


#
#-----[ COPY ]------------------------------------------
#
images/icon_gallery.gif to templates/subSilver/images/lang_english/icon_gallery.gif

#
#-----[ OPEN ]------------------------------------------ 
#
admin/admin_users.php

#
#-----[ FIND ]------------------------------------------
#
$yim = ( !empty($HTTP_POST_VARS['yim']) ) ? trim(strip_tags( $HTTP_POST_VARS['yim'] ) ) : '';

#
#-----[ AFTER, ADD ]------------------------------------------
#
$user_gallery = ( !empty($HTTP_POST_VARS['user_gallery']) ) ? trim( strip_tags($HTTP_POST_VARS['user_gallery'] ) ) : '';

#
#----[ FIND ]-----------------------------------
#
validate_optional_fields($icq, $aim, $msn, $yim, $website, $location, $occupation, $interests, $signature);


#
#-----[ REPLACE WITH ]----------------------------------
#
validate_optional_fields($icq, $aim, $msn, $yim, $website, $location, $occupation, $interests, $signature, $user_gallery);

#
#-----[ FIND ]----------------------------------------
#
$yim = htmlspecialchars(stripslashes($yim));

#
#-----[ AFTER, ADD ]------------------------------------------------------
#
$gallery = htmlspecialchars(stripslashes($gallery));

#
#-----[ FIND ]-------------------------------------------
#
SET " . $username_sql . $passwd_sql . "user_email = '" . str_replace("\'", "''", $email) . "', user_icq = '" . str_replace("\'", "''", $icq) . "', user_website = '" . str_replace("\'", "''", $website) . "', user_occ = '" . str_replace("\'", "''", $occupation) . "', user_from = '" . str_replace("\'", "''", $location) . "', user_interests = '" . str_replace("\'", "''", $interests) . "', user_sig = '" . str_replace("\'", "''", $signature) . "', user_viewemail = $viewemail, user_aim = '" . str_replace("\'", "''", $aim) . "', user_yim = '" . str_replace("\'", "''", $yim) . "', user_msnm = '" . str_replace("\'", "''", $msn) . "', user_attachsig = $attachsig, user_sig_bbcode_uid = '$signature_bbcode_uid', user_allowsmile = $allowsmilies, user_allowhtml = $allowhtml, user_allowavatar = $user_allowavatar, user_allowbbcode = $allowbbcode, user_allow_viewonline = $allowviewonline, user_notify = $notifyreply, user_allow_pm = $user_allowpm, user_notify_pm = $notifypm, user_popup_pm = $popuppm, user_lang = '" . str_replace("\'", "''", $user_lang) . "', user_style = $user_style, user_timezone = $user_timezone, user_dateformat = '" . str_replace("\'", "''", $user_dateformat) . "', user_active = $user_status, user_rank = $user_rank" . $avatar_sql . "


#
#-----[ IN-LINE FIND ]------------------------------------------------
#
user_rank = $user_rank

#
#-----[ IN-LINE AFTER, ADD ]-----------------------------
#
, user_gallery = '" . str_replace("\'", "''", $user_gallery) . "'

#
#-----[ FIND ]--------------------------------------
#
$yim = htmlspecialchars(stripslashes($yim));

#
#-----[ AFTER, ADD ]------------------------------------------------------
#
$gallery = htmlspecialchars(stripslashes($gallery));

#
#-----[ FIND ]---------------------------------------------
#
$yim = htmlspecialchars($this_userdata['user_yim']);


#
#-----[ AFTER, ADD ]------------------------------------
#
$user_gallery = htmlspecialchars($this_userdata['user_gallery']);

#
#-----[ FIND ]---------------------------------------
#
$s_hidden_fields .= '&lt;input type="hidden" name="user_rank" value="' . $user_rank . '" /&gt;';

#
#-----[ AFTER, ADD]-----------------------------------
#
$s_hidden_fields .= '&lt;input type="hidden" name="user_gallery" value="' . $user_gallery . '" /&gt;';


#
#-----[ FIND ]------------------------------------
#
'RANK_SELECT_BOX' =&gt; $rank_select_box,

#
#-----[ AFTER, ADD ]------------------------------------
#
'GALLERYID' =&gt; $user_gallery,

#
#-----[ FIND ]------------------------------------
#
'L_SELECT_RANK' =&gt; $lang['Rank_title'],

#
#-----[ AFTER, ADD ]------------------------------------
#
'L_GALLERY_ID' =&gt; $lang['Gallery_id'],


#
#-----[ OPEN ]------------------------------------
#
includes/usercp_register.php

#
#-----[ FIND ]------------------------------------
#
	validate_optional_fields($icq, $aim, $msn, $yim, $website, $location, $occupation, $interests, $signature);

#
#-----[ REPLACE WITH ]------------------------------------
#
	validate_optional_fields($icq, $aim, $msn, $yim, $website, $location, $occupation, $interests, $signature, $gallery);


#
#-----[ OPEN ]------------------------------------
#
includes/usercp_viewprofile.php

#
#-----[ FIND ]------------------------------------
#
$aim_img = ( $profiledata['user_aim'] ) ? '&lt;a href="aim:goim?screenname=' . $profiledata['user_aim'] . '&message=Hello+Are+you+there?"&gt;&lt;img src="' . $images['icon_aim'] . '" alt="' . $lang['AIM'] . '" title="' . $lang['AIM'] . '" border="0" /&gt;&lt;/a&gt;' : ' ';


#
#-----[ BEFORE, ADD ]------------------------------------
#
if ( !empty($profiledata['user_gallery']) )
{
  $gallery_uri = append_sid("gallery2.$phpEx?g2_view=core.ShowItem&g2_itemId=" . $profiledata['user_gallery']);
  $gallery_img = '&lt;a href="' . $gallery_uri . '"&gt;&lt;img src="' . $images['icon_gallery'] . '" alt="' . $lang['Gallery'] . '" title="' . $lang['Gallery'] . '" border="0" /&gt;&lt;/a&gt;';
}
else
{
  $gallery_img = "";
}

#
#-----[ FIND ]------------------------------------
#
'YIM' =&gt; $yim,

#
#-----[ AFTER, ADD ]------------------------------------
#
'GALLERY_IMG' =&gt; $gallery_img,

#
#-----[ FIND ]------------------------------------
#
'L_INTERESTS' =&gt; $lang['Interests'],

#
#-----[ AFTER, ADD]------------------------------------
#
'L_GALLERY' =&gt; $lang['Gallery'],

#
#-----[ OPEN ]------------------------------------
#
includes/functions_validate.php

#
#-----[ FIND ]------------------------------------
#
function validate_optional_fields(&$icq, &$aim, &$msnm, &$yim, &$website, &$location, &$occupation, &$interests, &$sig)

#
#-----[ REPLACE WITH ]------------------------------------
#
function validate_optional_fields(&$icq, &$aim, &$msnm, &$yim, &$website, &$location, &$occupation, &$interests, &$sig, &$gallery)

#
#-----[ FIND ]------------------------------------
#
// website has to start with http://, followed by something with length at least 3 that

#
#-----[ BEFORE, ADD ]------------------------------------
#
  // Gallery ID has to be only numbers.
  if (!preg_match('/^[0-9]+$/', $gallery))
  {
    $gallery = '';
  }

#
#-----[ OPEN ]------------------------------------
#
language/lang_english/lang_admin.php

#
#-----[ FIND ]------------------------------------
#
$lang['User_special_explain'] = 'These fields are not able to be modified by the users.  Here you can set their status and other options that are not given to users.';

#
#-----[ AFTER, ADD]------------------------------------
#
$lang['Gallery_id'] = 'Gallery ID';

#
#-----[ OPEN ]------------------------------------
#
language/lang_english/lang_main.php

#
#-----[ FIND ]------------------------------------
#
$lang['YIM'] = 'Yahoo Messenger';

#
#-----[ AFTER, ADD]------------------------------------
#
$lang['Gallery'] = 'Gallery';

#
#-----[ OPEN ]------------------------------------
#
templates/subSilver/admin/user_edit_body.tpl

#
#-----[ FIND ]------------------------------------
#
&lt;tr&gt;
   &lt;td class="row1"&gt;&lt;span class="gen"&gt;{L_SELECT_RANK}&lt;/span&gt;&lt;/td&gt;
   &lt;td class="row2"&gt;&lt;select name="user_rank"&gt;{RANK_SELECT_BOX}&lt;/select&gt;&lt;/td&gt;
&lt;/tr&gt;

#
#-----[ AFTER, ADD ]------------------------------------
#
&lt;tr&gt;
    &lt;td class="row1"&gt;&lt;span class="gen"&gt;{L_GALLERY_ID}&lt;/span&gt;&lt;/td&gt;
    &lt;td class="row2"&gt;&lt;input class="post" type="text" name="user_gallery" size="10" maxlength="10" value="{GALLERYID}" /&gt;&lt;/td&gt;
&lt;/tr&gt;


#
#-----[ OPEN ]------------------------------------
#
templates/subSilver/viewtopic_body.tpl

#
#-----[ FIND ]------------------------------------
#
&lt;td valign="middle" nowrap="nowrap"&gt;{postrow.PROFILE_IMG} {postrow.PM_IMG} {postrow.EMAIL_IMG} {postrow.WWW_IMG} {postrow.AIM_IMG} {postrow.YIM_IMG} {postrow.MSN_IMG} &lt;script language="JavaScript" type="text/javascript"&gt;&lt;!--

#
#-----[ IN-LINE FIND ]------------------------------------
#
{postrow.MSN_IMG}

#
#-----[ IN-LINE AFTER, ADD ]------------------------------------
#
{postrow.GALLERY_IMG}


#
#-----[ OPEN ]------------------------------------
#
templates/subSilver/profile_view_body.tpl

#
#-----[ FIND ]------------------------------------
#
  //--&gt;&lt;/script&gt;&lt;noscript&gt;{ICQ_IMG}&lt;/noscript&gt;&lt;/td&gt;
&lt;/tr&gt;

#
#-----[ AFTER, ADD ]------------------------------------
#
&lt;tr&gt;
   &lt;td valign="middle" nowrap="nowrap" align="right"&gt;&lt;span class="gen"&gt;{L_GALLERY}:&lt;/span&gt;&lt;/td&gt;
   &lt;td class="row1" valign="middle"&gt;&lt;span class="gen"&gt;{GALLERY_IMG}&lt;/span&gt;&lt;/td&gt;
&lt;/tr&gt;

#
#-----[ OPEN ]------------------------------------
#
templates/subSilver/privmsgs_read_body.tpl

#
#-----[ FIND ]------------------------------------
#
{WWW_IMG} {AIM_IMG} {YIM_IMG} {MSN_IMG} &lt;/td&gt;&lt;td&gt; &lt;/td&gt;&lt;td valign="top" nowrap="nowrap"&gt;&lt;script language="JavaScript" type="text/javascript"&gt;&lt;!--

#
#-----[ IN-LINE FIND ]------------------------------------
#
{MSN_IMG}

#
#-----[ IN-LINE AFTER, ADD ]------------------------------------
#
{GALLERY_IMG}


#
#-----[ OPEN ]------------------------------------
#
templates/subSilver/subSilver.cfg


#
#----[ FIND ]------------------------------------
#
$images['icon_msnm'] = "$current_template_images/{LANG}/icon_msnm.gif";

#
#----[ AFTER, ADD ]------------------------------------
#
$images['icon_gallery'] = "$current_template_images/{LANG}/icon_gallery.gif";

#
#-----[ OPEN ]------------------------------------
#
viewtopic.php

#
#-----[ FIND ]------------------------------------
#
$sql = "SELECT u.username, u.user_id, u.user_posts, u.user_from, u.user_website, u.user_email, u.user_icq, u.user_aim, u.user_yim, u.user_regdate, u.user_msnm, u.user_viewemail, u.user_rank, u.user_sig, u.user_sig_bbcode_uid, u.user_avatar, u.user_avatar_type, u.user_allowavatar, u.user_allowsmile, p.*,  pt.post_text, pt.post_subject, pt.bbcode_uid

#
#-----[ IN-LINE FIND ]------------------------------------
#
pt.bbcode_uid

#
#----[ IN-LINE AFTER, ADD ]------------------------------------
#
, u.user_gallery

#
#-----[ FIND ]------------------------------------
#
$aim_img = ( $postrow[$i]['user_aim'] ) ? '&lt;a href="aim:goim?screenname=' . $postrow[$i]['user_aim'] . '&message=Hello+Are+you+there?"&gt;&lt;img src="' . $images['icon_aim'] . '" alt="' . $lang['AIM'] . '" title="' . $lang['AIM'] . '" border="0" /&gt;&lt;/a&gt;' : '';

#
#-----[ BEFORE, ADD ]------------------------------------
#
if ( !empty($postrow[$i]['user_gallery']) )
{
  $gallery_uri = append_sid("gallery2.$phpEx?g2_view=core.ShowItem&g2_itemId=" . $postrow[$i]['user_gallery']);
  $gallery_img = '&lt;a href="' . $gallery_uri . '"&gt;&lt;img src="' . $images['icon_gallery'] . '" alt="' . $lang['Gallery'] . '" title="' . $lang['Gallery'] . '" border="0" /&gt;&lt;/a&gt;';
}
else
{
  $gallery_img = "";
}

#
#-----[ FIND ]------------------------------------
#
$icq = '';

#
#-----[ AFTER, ADD ]------------------------------------
#
$gallery_img = '';

#
#-----[ FIND ]------------------------------------
#
'ICQ' =&gt; $icq,

#
#-----[ AFTER, ADD ]------------------------------------
#
'GALLERY_IMG' =&gt; $gallery_img,

#
#-----[ OPEN ]------------------------------------
#
privmsg.php

#
#-----[ FIND ]------------------------------------
#
$sql = "SELECT u.username AS username_1, u.user_id AS user_id_1, u2.username AS username_2, u2.user_id AS user_id_2, u.user_sig_bbcode_uid, u.user_posts, u.user_from, u.user_website, u.user_email, u.user_icq, u.user_aim, u.user_yim, u.user_regdate, u.user_msnm, u.user_viewemail, u.user_rank, u.user_sig, u.user_avatar, pm.*, pmt.privmsgs_bbcode_uid, pmt.privmsgs_text

#
#-----[ IN-LINE FIND ]------------------------------------
#
u.user_avatar,

#
#-----[ IN-LINE AFTER, ADD ]------------------------------------
#
u.user_gallery,

#
#-----[ FIND ]------------------------------------
#
$aim_img = ( $privmsg['user_aim'] ) ? '&lt;a href="aim:goim?screenname=' . $privmsg['user_aim'] . '&message=Hello+Are+you+there?"&gt;&lt;img src="' . $images['icon_aim'] . '" alt="' . $lang['AIM'] . '" title="' . $lang['AIM'] . '" border="0" /&gt;&lt;/a&gt;' : '';

#
#-----[ BEFORE, ADD ]------------------------------------
#
if ( !empty($privmsg['user_gallery']) )
{
  $gallery_uri = append_sid("gallery2.$phpEx?g2_view=core.ShowItem&g2_itemId=" . $privmsg['user_gallery']);
  $gallery_img = '&lt;a href="' . $gallery_uri . '"&gt;&lt;img src="' . $images['icon_gallery'] . '" alt="' . $lang['Gallery'] . '" title="' . $lang['Gallery'] . '" border="0" /&gt;&lt;/a&gt;';
}
else
{
  $gallery_img = "";
}

#
#-----[ FIND ]------------------------------------
#
'ICQ' =&gt; $icq,

#
#----[ AFTER, ADD ]------------------------------------
#
'GALLERY_IMG' =&gt; $gallery_img,

#
#-----[ SAVE/CLOSE ALL FILES ]------------------------------------------
#
# EoM
		</pre>
		<h2>
		<a name="configuration">
		Configuration
		</a>
		</h2>
		<p class="toc-link">
		<a href="#toc">
		[table of contents]
		</a>
		</p>
		<p>
		Before you can view your Gallery 2 installation in phpBB2, you must 
		first configure this integration package. To do this, navigate to the 
		phpBB2 administration page and click on the "Gallery 2" link.  You will 
		now be presented with two options.
		</p>
		<p>The first area is the primary integration settings.  If these are 
		incorrectly set, your integration will not succeed.  Fear not though, as you 
		should really only have to fill in one value, making it fairly painless.
		</p>
		<h3>Gallery 2 Integration Settings</h3>
		<ol>
		<br />
		<li><b>URL path to the gallery2 directory</b> - This value depends on your 
		particular installation and you must ensure it is entered correctly.  This 
		should be the only setting that you might have to modify. It is the URL you 
		installed Gallery to and is the same URL that you would use to view your 
		gallery in standalone mode.  For example: <br />
		<div class="instructions">
		<p>http://www.example.com/gallery2/<br>
		/phpbb2/gallery2/<br>
		/gallery2/</p>
		</div>
		</li>
		<br />
		<li><b>URL path to gallery2.php</b> - This is the URL that would take you 
		to your Gallery 2 installation when it is integrated.  This value will be 
		auto-detected and should be correct, however, you should still verify the 
		setting.  For example:<br />
		<div class="instructions">
		<p>http://www.yoursite.com/phpbb2/gallery2.php</p>
		</div>
		</li>
		<li><b>URL path to login.php</b> - This is the URL which users must visit when 
		they want to log into your phpBB2 forums.  This value will be 
		auto-detected and should be correct, however, you should still verify the 
		setting. For example:<br />
		<div class="instructions">
		<p>http://www.yoursite.com/phpbb2/gallery2.php</p>
		</div>
		</li>
		<br />
		<i>The next 2 values will be automatically generated and managed by the integration 
		package. <b>Do not alter them.</b> They will not contain any information until 
		after you have saved the configuration settings and run the user integration at 
		least once. This is normal.</i>
		<br />
		<li><b>Full file path to the gallery2 directory</b> - This setting is the 
		complete path to your Gallery 2 directory.  For example:<br />
		<div class="instructions">
		<p>/home/myuser/public_html/gallery2/</p>
		</div>
		</li>
		<li><b>Active Admin ID</b> - This setting is the gallery external id of a valid admin.
		</li>
		</ol>
		<p>
		When you are finished, click the "Submit" button.  
		This will save your configuration to the phpBB2 database and will 
		verify that your Gallery 2 installation has been properly set up.  
		</p>
		<h3>Export Users to Gallery 2</h3>
		<p>
		This will export all your phpBB2 users and create a G2 account for them 
		if they do not have one. The phpBB2 admin accounts will also be 
		mapped to the G2 admin accounts.  Therefore, if you're logged as an admin 
		in phpBB2, you will also be logged as an admin in G2.
		</p>
		<h2>
		<a name="getting_help">
		Getting Help
		</a>
		</h2>
		<p class="toc-link">
		<a href="#toc">
		[table of contents]
		</a>
		</p>
		<p>
		If you are having problems getting your integration completed successfully, 
		start out by searching the Forums at <a href="http://www.nukedgallery.net">
		NukedGallery.net</a>.  Gallery2 specific help is offered in <a href="http://www.nukedgallery.net/forum13.html">
		this forum</a> on NukedGallery.</p>
		<p>If you are having general Gallery 2 problems,  you should start by looking in the <a href="http://gallery.menalto.com/index.php?name=PNphpBB2&amp;file=viewforum&amp;f=22">Gallery 2 Support Forum</a> on the <a href="http://gallery.sourceforge.net">Gallery
		  Website</a>.  Search the forum to see if somebody else has
		  posted a similar problem and maybe there's an answer
		  there, otherwise start a new topic to get help.  If the problem
		  seems like a bug in the Gallery 2 software you can <a href="http://sourceforge.net/tracker/?group_id=7130&amp;atid=107130">file a bug</a> in our bug tracker on
		  SourceForge.  Please read our <a href="http://gallery.sourceforge.net/wiki.php?page=Feature%20Requests%20and%20Bug%20Reports">tracker guidelines</a> before filing a bug so
		  that we can cut down on the number of spurious reports.  If
		  you're unsure whether to file a bug you can always post in the
		  forums first and we'll ask you to file a bug if needed.  If you
		  want to chat in real time, you can talk on our user-to-user irc
		  support channel, <a href="irc://irc.freenode.net/#gallery-support">#gallery-support on irc.freenode.net</a>.
		</p>

		<p>
		  Remember - reporting bugs is <b>good</b>.  Even if you think
		  it's silly, go ahead and report it.  We can always close the bug
		  or refile it (please don't be offended in this case) but it's
		  harder to find bugs than it is to fix them so we're counting on
		  you to help us with the finding part.
		</p>
		<h2>
		<a name="known_issues">
		Known Issues
		</a>
		</h2>
		<p class="toc-link">
		<a href="#toc">
		[table of contents]
		</a>
		</p>
		<p>
		The following are known issues with this integration package:
		</p>
		<ol>
		<li><b>Languages other than english not supported</b></li>
		</ol>
		<p>
		For a list of known issues with Gallery 2, view the <a href="http://cvs.sourceforge.net/viewcvs.py/*checkout*/gallery/gallery2/README.html#known_issues">
		Gallery 2 README</a>.
		</p>
    <hr />
	<p class="fineprint">
	$Id$
	</p>
	</body>
	</html>