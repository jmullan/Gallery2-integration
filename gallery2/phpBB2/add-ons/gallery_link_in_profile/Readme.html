<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
	<head>
		<meta content="text/html; charset=us-ascii" http-equiv="Content-Type" />
		<title>
		README: Profile Gallery Link Integration Add-On
		</title>
		<style type="text/css">
		html {
		font-family: "Lucida Grande", Verdana, Arial, sans-serif;
		font-size: 62.5%;
		}
		body {
		font-size: 1.2em;
		margin: 16px 16px 0px 16px;
		background: white;
		}
		a {
		text-decoration: none;
		}
		p {
		line-height: 1.5em;
		}
		h2 {
		font-family: "Gill Sans", Verdana, Arial, sans-serif;
		font-size: 1.5em;
		color: #333;
		border-bottom: 1px solid #ddd;
		margin: 0;
		padding: 1.0em 0 0.15em 0;
		}
		ul, ol {
		margin: 1.2em 0 1.2em 1.75em;
		padding: 0;
		}
		li {
		padding: 0.2em 0;
		line-height: 1.5em;
		}
		ol ul {
		margin-top: 0.4em;
		margin-bottom: 0.4em;
		}
		a:link {
		font-weight: 700;
		color: #5D728E;
		background-color: transparent;
		}
		a:visited {
		font-weight: 700;
		color: #5D728E;
		background-color: transparent;
		}
		a:hover {
		font-weight: 700;
		color: #B30400;
		text-decoration: underline;
		}
		div.instructions {
		background: #ddd;
		border: 1px solid #777;
		width: 480px;
		margin: 8px;
		padding: 0px;
		}
		div.instructions h3 {
		background: #ccc;
		border-bottom: 1px solid #777;
		font-size: 1.1em;
		margin: 0px 0px 4px 0px;
		padding: 4px;
		}
		div.instructions p {
		margin: 0px 0px 0px 4px;
		}
		.fineprint {
		font-size: .8em;
		color: #ccc;
		}
		div.toc {
		float: right;
		border: 1px solid #F15D22;
		background: #e9eff3;
		padding: 2px 4px 2px 4px;
		margin: 15px auto auto 15px;
		}
		div.toc h2 {
		font-size: 1.1em;
		margin-top: -8px;
		}
		p.toc-link {
		margin: 0px;
		}
		ul.toc-level-1 {
		margin: 0px 16px 0px 16px;
		list-style-type: none;
		}
		ul.toc-level-1 li {
		margin: auto;
		font-weight: bold;
		}
		ul.toc-level-2 {
		margin: auto 0px auto 15px;
		list-style-type: none;
		}
		ul.toc-level-2 li {
		margin: auto;
		}
		ul.toc-level-3 {
		margin: auto 0px auto 20px;
		list-style-type: none;
		}
		ul.toc-level-3 li {
		margin: auto;
		}
		pre.CodeSnippet	{
		background-color: #f0f0f0;
		padding: 1em;
		margin: 0px;
		border: 1px solid gray;
		font-family: "Lucida Console";
		font-size: 1em ;
		width: 800px ;
		color: #000000;
		overflow:auto;
		}
		pre.Console	{
		width: auto ;
		background-color: #000000; 
		color: #00ff00;
		}
		div.codecontainer {
		margin: 0px;
		width:800px;
		padding: 1em;
		}
		div.codecontainer h3 {
		background: #ccc;
		font-size: 1.1em;
		margin: 0px 0px 0px 0px;
		padding: 4px;
		}
		.important {
		background: #FACA61;
		border: 2px;
		width: 480px;
		margin: 0.6em 0 0.6em 0;
		padding: 0.6em;
		color: #C00;
		text-align: center;
		}
		.important .email {
		font-size: 1.3em;
		color: black;
		font-weight: 700;
		margin: 0.6em 0 0 0;
		}
		.important h3 {
		color: #eee;
		background: #f00;
		font-size: 1.3em;
		margin: -0.2em -0.2em 0.2em -0.2em;
		padding: 0.2em 0.2em;
		}
	</style>
	</head>
	<body>
		<div class="toc">
		<h2>
		<a name="toc">Contents</a>
		</h2>
		<ul class="toc-level-1">
			<li>
			Introduction
				<ul class="toc-level-2">
					<li>
					<a href="#description">
					Description
					</a>
					</li>
					<li>
					<a href="#dodont">
					What this package does
					</a>
					</li>
				</ul>
			</li>
			<li>
			Installation
				<ul class="toc-level-2">
					<li>
					<a href="#installing">
					Installing
					</a>
					</li>
					<li>
					<a href="#configuration">
					Configuration
					</a>
					</li>
				</ul>
			</li>
			<li>
			Help!
				<ul class="toc-level-2">
					<li>
					<a href="#getting_help">
					Getting Help
					</a>
					</li>
					<li>
					<a href="#known_issues">
					Known Issues / Bugs
					</a>
					</li>
				</ul>
			</li>
		</ul>
		</div>
		<div>
		<img alt="Gallery 2" src="../../images/g2Logo.gif" />
		</div>
		<p>
		Welcome to Gallery 2.1. This integration package is part of the 
		ongoing effort to seamlessly integrate Gallery 2 in phpBB2.  
		Please read through this document carefully
		before integrating Gallery 2 and before asking for help.  We have
		taken care to try to answer as many of your questions here as
		possible.  If you don't read this and have problems, we may
		refer you back to this document as a first resource.
		</p>
		<h2>
		<a name="description">
		Description
		</a>
		</h2>
		<p>
		This package contains all the information you will need 
		in order to include an optional mod to the basic integration package 
		that will add a gallery button to the users profile and posts.  
		<b>Standard Disclaimer: Back up all files/folders/databases 
		related to Gallery 2 and phpBB2 before attempting this integration.</b>
		</p>
		<h2>
		<a name="dodont">
		What this package does
		</a>
		</h2>
		<p class="toc-link">
		<a href="#toc">
		[table of contents]
		</a>
		</p>
		<p>
		Simply put, this MOD will create a "Gallery" button in the user's profile, as well as in the user's posts where the AIM/ICQ buttons appear, as shown in the sample screenshots.
		</p>
		<ol>
			<li>Creates a Gallery ID field in the ACP. (This can be set by an admin or automatically managed by the integration package with the included additional mod.)</li>
			<li>Creates a Gallery button in the users profile that links the users Gallery album.</li>
			<li>Creates a Gallery button in each of the users posts that links to the users Gallery album.</li>
		</ol>
		<p>
		This package <b>does not</b> install or configure Gallery 2 for you.  Before you 
		proceed with this add-on mod, you <b>must</b> install and configure Gallery 2 and get the basic integration working.
		</p>
		<div>
		<img alt="Screenshot 3" src="./images/Gallery3.jpg" /><br />
		<img alt="Screenshot 1" src="./images/Gallery1.jpg" /><br />
		<img alt="Screenshot 2" src="./images/Gallery2.jpg" /><br />
		</div>
		<h2>
		<a name="installing">
		Installation
		</a>
		</h2>
		<p class="toc-link">
		<a href="#toc">
		[table of contents]
		</a>
		</p>
		<div class="important">
		<h3>NOTICE</h3>
		<p>
		This integration package <b>does not</b> install or configure Gallery 2 for you.  Before you 
		proceed with this integration, you <b>must</b> install and configure Gallery 2 and have the basic integration already working.
		</p></div>
		<p>
		This package contains these folders:
		</p>
		<ul>
		<li>/images</li>
		</ul>
		<p>
		To install, simply follow the mod instructions.</p>
		<br />
		<p>The following MOD contains the required SQL and file modifications:</p>
		<pre class="CodeSnippet">##############################################################
## MOD Title: Gallery Profile Mod 
## MOD Author: PilotSpike &lt; firefighterspike33@yahoo.com &gt; (N/A) NA 
## MOD Description: This mod integrates the nuked G2 integration into user profiles 
## MOD Version: 0.1.0 
##
## Installation Level: Intermediate
## Installation Time: 45 Minutes
## Files To Edit: admin/admin_users.php, 
##	includes/usercp_register.php,
##	includes/usercp_viewprofile.php,
##	includes/functions_validate.php,
##	language/lang_english/lang_admin.php,
##	language/lang_english/lang_main.php,
##	templates/subSilver/admin/user_edit_body.tpl,
##	templates/subSilver/viewtopic_body.tpl,
##	templates/subSilver/profile_view_body.tpl,
##	templates/subSilver/privmsgs_read_body.tpl,
##	templates/subSilver/subSilver.cfg,
##	viewtopic.php,
##	privmsg.php
## Included Files: images/icon_gallery.gif 
## License: http://opensource.org/licenses/gpl-license.php GNU General Public License v2
##############################################################
## For security purposes, please check: http://www.phpbb.com/mods/
## for the latest version of this MOD. Although MODs are checked
## before being allowed in the MODs Database there is no guarantee
## that there are no security problems within the MOD. No support
## will be given for MODs not found within the MODs Database which
## can be found at http://www.phpbb.com/mods/
##############################################################
## Author Notes:
##
##############################################################
## MOD History:
##
## 2005-12-17 - Version 0.1.0 
##      - Initial Developmental Release 
##
## 2006-01-16 - A few tweaks to make code functional - Scott Gregory (aka...jettyrat)
##	includes/usercp_register.php,
##	includes/usercp_viewprofile.php,
##	language/lang_english/lang_main.php,
##
##############################################################
## Before Adding This MOD To Your Forum, You Should Back Up All Files Related To This MOD
##############################################################

#
#-----[ SQL ]------------------------------------------
#
ALTER TABLE phpbb_users ADD user_gallery VARCHAR(10) NULL DEFAULT NULL; 

#
#-----[ COPY ]------------------------------------------
#
images/icon_gallery.gif to templates/subSilver/images/lang_english/icon_gallery.gif

#
#-----[ OPEN ]------------------------------------------ 
#
admin/admin_users.php

#
#-----[ FIND ]------------------------------------------
#
$yim = ( !empty($HTTP_POST_VARS['yim']) ) ? trim(strip_tags( $HTTP_POST_VARS['yim'] ) ) : '';

#
#-----[ AFTER, ADD ]------------------------------------------
#
$user_gallery = ( !empty($HTTP_POST_VARS['user_gallery']) ) ? trim( strip_tags($HTTP_POST_VARS['user_gallery'] ) ) : '';

#
#----[ FIND ]-----------------------------------
#
validate_optional_fields($icq, $aim, $msn, $yim, $website, $location, $occupation, $interests, $signature);

#
#-----[ REPLACE WITH ]----------------------------------
#
validate_optional_fields($icq, $aim, $msn, $yim, $website, $location, $occupation, $interests, $signature, $user_gallery);

#
#-----[ FIND ]----------------------------------------
#
$yim = htmlspecialchars(stripslashes($yim));

#
#-----[ AFTER, ADD ]------------------------------------------------------
#
$gallery = htmlspecialchars(stripslashes($gallery));

#
#-----[ FIND ]-------------------------------------------
#
SET " . $username_sql . $passwd_sql . "user_email = '" . str_replace("\'", "''", $email) . "', user_icq = '" . str_replace("\'", "''", $icq) . "', user_website = '" . str_replace("\'", "''", $website) . "', user_occ = '" . str_replace("\'", "''", $occupation) . "', user_from = '" . str_replace("\'", "''", $location) . "', user_interests = '" . str_replace("\'", "''", $interests) . "', user_sig = '" . str_replace("\'", "''", $signature) . "', user_viewemail = $viewemail, user_aim = '" . str_replace("\'", "''", $aim) . "', user_yim = '" . str_replace("\'", "''", $yim) . "', user_msnm = '" . str_replace("\'", "''", $msn) . "', user_attachsig = $attachsig, user_sig_bbcode_uid = '$signature_bbcode_uid', user_allowsmile = $allowsmilies, user_allowhtml = $allowhtml, user_allowavatar = $user_allowavatar, user_allowbbcode = $allowbbcode, user_allow_viewonline = $allowviewonline, user_notify = $notifyreply, user_allow_pm = $user_allowpm, user_notify_pm = $notifypm, user_popup_pm = $popuppm, user_lang = '" . str_replace("\'", "''", $user_lang) . "', user_style = $user_style, user_timezone = $user_timezone, user_dateformat = '" . str_replace("\'", "''", $user_dateformat) . "', user_active = $user_status, user_rank = $user_rank" . $avatar_sql . "

#
#-----[ IN-LINE FIND ]------------------------------------------------
#
user_rank = $user_rank

#
#-----[ IN-LINE AFTER, ADD ]-----------------------------
#
, user_gallery = '" . str_replace("\'", "''", $user_gallery) . "'

#
#-----[ FIND ]--------------------------------------
#
$yim = htmlspecialchars(stripslashes($yim));

#
#-----[ AFTER, ADD ]------------------------------------------------------
#
$gallery = htmlspecialchars(stripslashes($gallery));

#
#-----[ FIND ]---------------------------------------------
#
$yim = htmlspecialchars($this_userdata['user_yim']);

#
#-----[ AFTER, ADD ]------------------------------------
#
$user_gallery = htmlspecialchars($this_userdata['user_gallery']);

#
#-----[ FIND ]---------------------------------------
#
$s_hidden_fields .= '&lt;input type="hidden" name="user_rank" value="' . $user_rank . '" /&gt;';

#
#-----[ AFTER, ADD]-----------------------------------
#
$s_hidden_fields .= '&lt;input type="hidden" name="user_gallery" value="' . $user_gallery . '" /&gt;';

#
#-----[ FIND ]------------------------------------
#
'RANK_SELECT_BOX' =&gt; $rank_select_box,

#
#-----[ AFTER, ADD ]------------------------------------
#
'GALLERYID' =&gt; $user_gallery,

#
#-----[ FIND ]------------------------------------
#
'L_SELECT_RANK' =&gt; $lang['Rank_title'],

#
#-----[ AFTER, ADD ]------------------------------------
#
'L_GALLERY_ID' =&gt; $lang['Gallery_id'],

#
#-----[ OPEN ]------------------------------------
#
includes/usercp_register.php

#
#-----[ FIND ]------------------------------------
#
	validate_optional_fields($icq, $aim, $msn, $yim, $website, $location, $occupation, $interests, $signature);

#
#-----[ REPLACE WITH ]------------------------------------
#
	validate_optional_fields($icq, $aim, $msn, $yim, $website, $location, $occupation, $interests, $signature, $gallery);

#
#-----[ OPEN ]------------------------------------
#
includes/usercp_viewprofile.php

#
#-----[ FIND ]------------------------------------
#
$aim_img = ( $profiledata['user_aim'] ) ? '&lt;a href="aim:goim?screenname=' . $profiledata['user_aim'] . '&message=Hello+Are+you+there?"&gt;&lt;img src="' . $images['icon_aim'] . '" alt="' . $lang['AIM'] . '" title="' . $lang['AIM'] . '" border="0" /&gt;&lt;/a&gt;' : ' ';

#
#-----[ BEFORE, ADD ]------------------------------------
#
if ( !empty($profiledata['user_gallery']) )
{
  $gallery_uri = append_sid("gallery2.$phpEx?g2_view=core.ShowItem&g2_itemId=" . $profiledata['user_gallery']);
  $gallery_img = '&lt;a href="' . $gallery_uri . '"&gt;&lt;img src="' . $images['icon_gallery'] . '" alt="' . $lang['Gallery'] . '" title="' . $lang['Gallery'] . '" border="0" /&gt;&lt;/a&gt;';
}
else
{
  $gallery_img = "";
}

#
#-----[ FIND ]------------------------------------
#
'YIM' =&gt; $yim,

#
#-----[ AFTER, ADD ]------------------------------------
#
'GALLERY_IMG' =&gt; $gallery_img,

#
#-----[ FIND ]------------------------------------
#
'L_INTERESTS' =&gt; $lang['Interests'],

#
#-----[ AFTER, ADD]------------------------------------
#
'L_GALLERY' =&gt; $lang['Gallery'],

#
#-----[ OPEN ]------------------------------------
#
includes/functions_validate.php

#
#-----[ FIND ]------------------------------------
#
function validate_optional_fields(&$icq, &$aim, &$msnm, &$yim, &$website, &$location, &$occupation, &$interests, &$sig)

#
#-----[ REPLACE WITH ]------------------------------------
#
function validate_optional_fields(&$icq, &$aim, &$msnm, &$yim, &$website, &$location, &$occupation, &$interests, &$sig, &$gallery)

#
#-----[ FIND ]------------------------------------
#
// website has to start with http://, followed by something with length at least 3 that

#
#-----[ BEFORE, ADD ]------------------------------------
#
  // Gallery ID has to be only numbers.
  if (!preg_match('/^[0-9]+$/', $gallery))
  {
    $gallery = '';
  }

#
#-----[ OPEN ]------------------------------------
#
language/lang_english/lang_admin.php

#
#-----[ FIND ]------------------------------------
#
$lang['User_special_explain'] = 'These fields are not able to be modified by the users.  Here you can set their status and other options that are not given to users.';

#
#-----[ AFTER, ADD]------------------------------------
#
$lang['Gallery_id'] = 'Gallery ID';

#
#-----[ OPEN ]------------------------------------
#
language/lang_english/lang_main.php

#
#-----[ FIND ]------------------------------------
#
$lang['YIM'] = 'Yahoo Messenger';

#
#-----[ AFTER, ADD]------------------------------------
#
$lang['Gallery'] = 'Gallery';

#
#-----[ OPEN ]------------------------------------
#
templates/subSilver/admin/user_edit_body.tpl

#
#-----[ FIND ]------------------------------------
#
&lt;tr&gt;
   &lt;td class="row1"&gt;&lt;span class="gen"&gt;{L_SELECT_RANK}&lt;/span&gt;&lt;/td&gt;
   &lt;td class="row2"&gt;&lt;select name="user_rank"&gt;{RANK_SELECT_BOX}&lt;/select&gt;&lt;/td&gt;
&lt;/tr&gt;

#
#-----[ AFTER, ADD ]------------------------------------
#
&lt;tr&gt;
    &lt;td class="row1"&gt;&lt;span class="gen"&gt;{L_GALLERY_ID}&lt;/span&gt;&lt;/td&gt;
    &lt;td class="row2"&gt;&lt;input class="post" type="text" name="user_gallery" size="10" maxlength="10" value="{GALLERYID}" /&gt;&lt;/td&gt;
&lt;/tr&gt;

#
#-----[ OPEN ]------------------------------------
#
templates/subSilver/viewtopic_body.tpl

#
#-----[ FIND ]------------------------------------
#
&lt;td valign="middle" nowrap="nowrap"&gt;{postrow.PROFILE_IMG} {postrow.PM_IMG} {postrow.EMAIL_IMG} {postrow.WWW_IMG} {postrow.AIM_IMG} {postrow.YIM_IMG} {postrow.MSN_IMG} &lt;script language="JavaScript" type="text/javascript"&gt;&lt;!--

#
#-----[ IN-LINE FIND ]------------------------------------
#
{postrow.MSN_IMG}

#
#-----[ IN-LINE AFTER, ADD ]------------------------------------
#
{postrow.GALLERY_IMG}

#
#-----[ OPEN ]------------------------------------
#
templates/subSilver/profile_view_body.tpl

#
#-----[ FIND ]------------------------------------
#
  //--&gt;&lt;/script&gt;&lt;noscript&gt;{ICQ_IMG}&lt;/noscript&gt;&lt;/td&gt;
&lt;/tr&gt;

#
#-----[ AFTER, ADD ]------------------------------------
#
&lt;tr&gt;
   &lt;td valign="middle" nowrap="nowrap" align="right"&gt;&lt;span class="gen"&gt;{L_GALLERY}:&lt;/span&gt;&lt;/td&gt;
   &lt;td class="row1" valign="middle"&gt;&lt;span class="gen"&gt;{GALLERY_IMG}&lt;/span&gt;&lt;/td&gt;
&lt;/tr&gt;

#
#-----[ OPEN ]------------------------------------
#
templates/subSilver/privmsgs_read_body.tpl

#
#-----[ FIND ]------------------------------------
#
{WWW_IMG} {AIM_IMG} {YIM_IMG} {MSN_IMG} &lt;/td&gt;&lt;td&gt; &lt;/td&gt;&lt;td valign="top" nowrap="nowrap"&gt;&lt;script language="JavaScript" type="text/javascript"&gt;&lt;!--

#
#-----[ IN-LINE FIND ]------------------------------------
#
{MSN_IMG}

#
#-----[ IN-LINE AFTER, ADD ]------------------------------------
#
{GALLERY_IMG}

#
#-----[ OPEN ]------------------------------------
#
templates/subSilver/subSilver.cfg

#
#----[ FIND ]------------------------------------
#
$images['icon_msnm'] = "$current_template_images/{LANG}/icon_msnm.gif";

#
#----[ AFTER, ADD ]------------------------------------
#
$images['icon_gallery'] = "$current_template_images/{LANG}/icon_gallery.gif";

#
#-----[ OPEN ]------------------------------------
#
viewtopic.php

#
#-----[ FIND ]------------------------------------
#
$sql = "SELECT u.username, u.user_id, u.user_posts, u.user_from, u.user_website, u.user_email, u.user_icq, u.user_aim, u.user_yim, u.user_regdate, u.user_msnm, u.user_viewemail, u.user_rank, u.user_sig, u.user_sig_bbcode_uid, u.user_avatar, u.user_avatar_type, u.user_allowavatar, u.user_allowsmile, p.*,  pt.post_text, pt.post_subject, pt.bbcode_uid

#
#-----[ IN-LINE FIND ]------------------------------------
#
pt.bbcode_uid

#
#----[ IN-LINE AFTER, ADD ]------------------------------------
#
, u.user_gallery

#
#-----[ FIND ]------------------------------------
#
$aim_img = ( $postrow[$i]['user_aim'] ) ? '&lt;a href="aim:goim?screenname=' . $postrow[$i]['user_aim'] . '&message=Hello+Are+you+there?"&gt;&lt;img src="' . $images['icon_aim'] . '" alt="' . $lang['AIM'] . '" title="' . $lang['AIM'] . '" border="0" /&gt;&lt;/a&gt;' : '';

#
#-----[ BEFORE, ADD ]------------------------------------
#
if ( !empty($postrow[$i]['user_gallery']) )
{
  $gallery_uri = append_sid("gallery2.$phpEx?g2_view=core.ShowItem&g2_itemId=" . $postrow[$i]['user_gallery']);
  $gallery_img = '&lt;a href="' . $gallery_uri . '"&gt;&lt;img src="' . $images['icon_gallery'] . '" alt="' . $lang['Gallery'] . '" title="' . $lang['Gallery'] . '" border="0" /&gt;&lt;/a&gt;';
}
else
{
  $gallery_img = "";
}

#
#-----[ FIND ]------------------------------------
#
$icq = '';

#
#-----[ AFTER, ADD ]------------------------------------
#
$gallery_img = '';

#
#-----[ FIND ]------------------------------------
#
'ICQ' =&gt; $icq,

#
#-----[ AFTER, ADD ]------------------------------------
#
'GALLERY_IMG' =&gt; $gallery_img,

#
#-----[ OPEN ]------------------------------------
#
privmsg.php

#
#-----[ FIND ]------------------------------------
#
$sql = "SELECT u.username AS username_1, u.user_id AS user_id_1, u2.username AS username_2, u2.user_id AS user_id_2, u.user_sig_bbcode_uid, u.user_posts, u.user_from, u.user_website, u.user_email, u.user_icq, u.user_aim, u.user_yim, u.user_regdate, u.user_msnm, u.user_viewemail, u.user_rank, u.user_sig, u.user_avatar, pm.*, pmt.privmsgs_bbcode_uid, pmt.privmsgs_text

#
#-----[ IN-LINE FIND ]------------------------------------
#
u.user_avatar,

#
#-----[ IN-LINE AFTER, ADD ]------------------------------------
#
u.user_gallery,

#
#-----[ FIND ]------------------------------------
#
$aim_img = ( $privmsg['user_aim'] ) ? '&lt;a href="aim:goim?screenname=' . $privmsg['user_aim'] . '&message=Hello+Are+you+there?"&gt;&lt;img src="' . $images['icon_aim'] . '" alt="' . $lang['AIM'] . '" title="' . $lang['AIM'] . '" border="0" /&gt;&lt;/a&gt;' : '';

#
#-----[ BEFORE, ADD ]------------------------------------
#
if ( !empty($privmsg['user_gallery']) )
{
  $gallery_uri = append_sid("gallery2.$phpEx?g2_view=core.ShowItem&g2_itemId=" . $privmsg['user_gallery']);
  $gallery_img = '&lt;a href="' . $gallery_uri . '"&gt;&lt;img src="' . $images['icon_gallery'] . '" alt="' . $lang['Gallery'] . '" title="' . $lang['Gallery'] . '" border="0" /&gt;&lt;/a&gt;';
}
else
{
  $gallery_img = "";
}

#
#-----[ FIND ]------------------------------------
#
'ICQ' =&gt; $icq,

#
#----[ AFTER, ADD ]------------------------------------
#
'GALLERY_IMG' =&gt; $gallery_img,

#
#-----[ SAVE/CLOSE ALL FILES ]------------------------------------------
#
# EoM
		</pre>
		<br />
		<p>The following optional MOD contains the required file modifications to automatically allow the integration to manage the Gallery album setting for users that own an album:</p>
		<pre class="CodeSnippet">##############################################################
## MOD Title: MOD for PilotSpikes MOD to Auto-manage Gallery Album ID 
## MOD Author: Scott Gregory &lt; jettyrat@jettyfishing.com &gt; (N/A) NA 
## MOD Description: This mod allows the integration to auto-manage the album id field 
## MOD Version: 0.1.0 
##
## Installation Level: Easy
## Installation Time: 5 Minutes
## Files To Edit: g2helper.inc, 
## License: http://opensource.org/licenses/gpl-license.php GNU General Public License v2
##############################################################
## Author Notes:
##
##############################################################
## MOD History:
##
## 2006-04-21 - Version 0.1.0 
##      - Initial Developmental Release 
##
##############################################################
## Before Adding This MOD To Your Forum, You Should Back Up All Files Related To This MOD
###############################################################
#-----[ OPEN ]------------------------------------------
#
g2helper.inc

#
#-----[ FIND ]------------------------------------------
#
			$this-&gt;_init_array['activeUserId'] = $userdata['user_id'];

			$ret = GalleryEmbed::isExternalIdMapped($userdata['user_id'], 'GalleryUser');
			if (empty($ret)) {

#
#-----[ AFTER, ADD ]------------------------------------------
#
				$this-&gt;_mapGalleryLink($userdata['user_id'], $userdata['user_gallery']);

#
#-----[ FIND ]------------------------------------------
#
	function _createUser($id, $level, $newUserData) {

#
#-----[ BEFORE, ADD ]------------------------------------------
#
	function _mapGalleryLink($userId, $userGallery) {
		global $db, $gallery;

		if (isset($userGallery)) {
			list ($ret, $entityId) = GalleryCoreApi::loadEntityByExternalId($userId, 'GalleryUser');
			if (isset($ret)) {
				$this-&gt;_errorHandler(GENERAL_ERROR, "loadEntityByExternalId failed for $userId. Here is the error message from G2: &lt;br /&gt;" . $ret-&gt;getAsHtml(), __LINE__, __FILE__);
			}

			list ($ret, $itemIds) = GalleryCoreApi::fetchAllItemIdsByOwnerId($entityId-&gt;getId());
			if (isset($ret)) {
				$this-&gt;_errorHandler(GENERAL_ERROR, 'fetchAllItemIdsByOwnerId failed for ' . $entityId-&gt;getId() . '. Here is the error message from G2: &lt;br /&gt;' . $ret-&gt;getAsHtml(), __LINE__, __FILE__);
			}

			if (in_array($userGallery, $itemIds)) {
				return;
			}
		}

		if (empty($entityId)) {
			list ($ret, $entityId) = GalleryCoreApi::loadEntityByExternalId($userId, 'GalleryUser');
			if (isset($ret)) {
				$this-&gt;_errorHandler(GENERAL_ERROR, "loadEntityByExternalId failed for $userId. Here is the error message from G2: &lt;br /&gt;" . $ret-&gt;getAsHtml(), __LINE__, __FILE__);
			}
		}

		if (empty($itemIds)) {
			list ($ret, $itemIds) = GalleryCoreApi::fetchAllItemIdsByOwnerId($entityId-&gt;getId());
			if (isset($ret)) {
				$this-&gt;_errorHandler(GENERAL_ERROR, 'fetchAllItemIdsByOwnerId failed for ' . $entityId-&gt;getId() . '. Here is the error message from G2: &lt;br /&gt;' . $ret-&gt;getAsHtml(), __LINE__, __FILE__);
			}
		}

		$query = "SELECT [Entity::id] FROM [Entity] WHERE [Entity::entityType] = ?";
		list ($ret, $results) = $gallery-&gt;search($query, array('GalleryAlbumItem'));
		if (isset($ret)) {
			$this-&gt;_errorHandler(GENERAL_ERROR, 'Unable to fetch entity information from the G2 entity table. Here is the error message from G2: &lt;br /&gt;' . $ret-&gt;getAsHtml(), __LINE__, __FILE__);
		}

		while ($g2Result = $results-&gt;nextResult()) {
			if (in_array($g2Result[0], $itemIds)) {
				$sql = 'UPDATE ' . USERS_TABLE . ' SET user_gallery = ' . $g2Result[0] . " WHERE user_id = $userId";
				if (!$db-&gt;sql_query($sql)) {
					$this-&gt;_errorHandler(CRITICAL_ERROR, 'Could not update user_gallery in ' . USERS_TABLE . '.', __LINE__, __FILE__, $sql);
				}

				return;
			}
		}

		$sql = 'UPDATE ' . USERS_TABLE . " SET user_gallery = NULL WHERE user_id = $userId";
		if (!$db-&gt;sql_query($sql)) {
			$this-&gt;_errorHandler(CRITICAL_ERROR, 'Could not update user_gallery in ' . USERS_TABLE . '.', __LINE__, __FILE__, $sql);
		}
	}

#
#-----[ SAVE/CLOSE ALL FILES ]------------------------------------------
#
# EoM
		</pre>
		<h2>
		<a name="configuration">
		Configuration
		</a>
		</h2>
		<p class="toc-link">
		<a href="#toc">
		[table of contents]
		</a>
		</p>
		<p>
		<p>
		If you are not going to use the auto-manage addition to this mod, then an admin will have to manually set the album id for each user in the ACP.  If you are using the auto-manage mod, no configuration is necessary.
		</p>
		<h2>
		<a name="getting_help">
		Getting Help
		</a>
		</h2>
		<p class="toc-link">
		<a href="#toc">
		[table of contents]
		</a>
		</p>
		<p>
		If you are having problems getting your add-on mod completed successfully, 
		start out by searching the Forums at <a href="http://www.nukedgallery.net">
		NukedGallery.net</a>.  Gallery2 specific help is offered in <a href="http://www.nukedgallery.net/forum13.html">
		this forum</a> on NukedGallery.</p>
		<p>If you are having general Gallery 2 problems,  you should start by looking in the <a href="http://gallery.menalto.com/index.php?name=PNphpBB2&amp;file=viewforum&amp;f=22">Gallery 2 Support Forum</a> on the <a href="http://gallery.sourceforge.net">Gallery
		  Website</a>.  Search the forum to see if somebody else has
		  posted a similar problem and maybe there's an answer
		  there, otherwise start a new topic to get help.  If the problem
		  seems like a bug in the Gallery 2 software you can <a href="http://sourceforge.net/tracker/?group_id=7130&amp;atid=107130">file a bug</a> in our bug tracker on
		  SourceForge.  Please read our <a href="http://gallery.sourceforge.net/wiki.php?page=Feature%20Requests%20and%20Bug%20Reports">tracker guidelines</a> before filing a bug so
		  that we can cut down on the number of spurious reports.  If
		  you're unsure whether to file a bug you can always post in the
		  forums first and we'll ask you to file a bug if needed.  If you
		  want to chat in real time, you can talk on our user-to-user irc
		  support channel, <a href="irc://irc.freenode.net/#gallery-support">#gallery-support on irc.freenode.net</a>.
		</p>

		<p>
		  Remember - reporting bugs is <b>good</b>.  Even if you think
		  it's silly, go ahead and report it.  We can always close the bug
		  or refile it (please don't be offended in this case) but it's
		  harder to find bugs than it is to fix them so we're counting on
		  you to help us with the finding part.
		</p>
		<h2>
		<a name="known_issues">
		Known Issues
		</a>
		</h2>
		<p class="toc-link">
		<a href="#toc">
		[table of contents]
		</a>
		</p>
		<p>
		The following are known issues with this add-on mod package:
		</p>
		<p>
		For a list of known issues with Gallery 2, view the <a href="http://svn.sourceforge.net/viewcvs.cgi/*checkout*/gallery/trunk/gallery2/README.html?rev=13566#known_issues">
		Gallery 2 README</a>.
		</p>
    <hr />
	<p class="fineprint">
	$Id$
	</p>
	</body>
	</html>
